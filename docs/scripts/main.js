"use strict";function getCoordinates(){function e(e){var o={};o.lang=lang,o.searchtype="con",o.geo=e.coords.latitude+","+e.coords.longitude,getSearchResults(o)}function o(){console.log("Error with geolocation")}navigator.geolocation&&navigator.geolocation.getCurrentPosition(e,o)}function getSearchResults(e){$("#results-container, #office-search").addClass("hide").html(""),$.getJSON(modelUrl,e).always().done(function(e){var o=JSON.parse(e);allConsultants=shuffle(o),displaySearchResults("result-amount-template",allConsultants,"results-container"),paginateResults(),$("html, body").animate({scrollTop:$("#office-search").offset().top},750)}).fail(function(e){console.log("Data could not be retrieved, please try again",e.status+" "+e.statusText)}),(e.city||e.Pcode||e.geo)&&(e.searchtype="office",e.name="",$.getJSON(modelUrl,e).always().done(function(e){var o=JSON.parse(e);o.length>0&&displaySearchResults("office-template",o,"office-search")}).fail(function(e){console.log("Data could not be retrieved, please try again",e.status+" "+e.statusText)}))}function shuffle(e){for(var o,t,n=e.length;0!==n;)t=Math.floor(Math.random()*n),n-=1,o=e[n],e[n]=e[t],e[t]=o;return e}function paginateResults(){var e=allConsultants.slice(0,5);allConsultants.splice(0,5),displaySearchResults("consultant-template",e,"results-container"),allConsultants.length>0&&displaySearchResults("view-more-template",[],"results-container")}function parseSearchString(){var e={},o=$location_field.val(),t=$name_field.val(),n=new RegExp(/[A-Za-z][0-9][A-Za-z] ?[0-9][A-Za-z][0-9]/);if(e.city="",e.name="",e.Pcode="",e.geo="",e.lang=lang,e.searchtype="con",n.test(o)){var s=o.match(n)[0];s.indexOf(" ")===-1&&(s=s.match(/.{1,3}/g).join().replace(","," ")),e.Pcode=s,o=o.replace(n," ")}return is_name_query?e.name=t:e.city=o,e}function displaySearchResults(e,o,t){var n=document.getElementById(e).innerHTML;Mustache.parse(n);var s=Mustache.render(n,o);$("#"+t).removeClass("hide").append(s),attachComponents(),$("#results-placeholder").addClass("hide")}function attachComponents(){$(document).foundation(),$("[data-fetch-results]").on("click",function(e){e.preventDefault(),$(this).remove(),paginateResults()})}function sendGoogleAnalytics(e){""!==e.name?ga("send","event","Convert","Search","ConnectToAdvisor_Name?"+e.name,0):""!==e.city?ga("send","event","Convert","Search","ConnectToAdvisor_Location?"+e.city,0):""!==e.Pcode&&ga("send","event","Convert","Search","ConnectToAdvisor_Pcode?"+e.Pcode,0)}var form=function(){function e(){$(document).foundation(),$(".ig-form").length&&(l=$(".ig-form"),r=l.find("form"),a=l.find("form").data("endpoint"),i=l.find("form").data("cancel"),$(".toggler").on("click",function(){$(".toggle-content").hide(),$("."+$(this).data("content")).show()}),o())}function o(){var e=$(":input, textarea");e.change(function(e){$(this).addClass("dirty")}),$.validator.setDefaults({debug:!0,success:"valid"}),$.validator.addMethod("cdnPostal",function(e,o){return this.optional(o)||e.match(/[a-zA-Z][0-9][a-zA-Z](-| |)[0-9][a-zA-Z][0-9]/)},"Please specify a valid postal code."),r.validate({submitHandler:function(){form.process()},errorPlacement:function(e,o){$(o).closest(".row").find(".custom-error-location").length?$(o).closest(".row").find(".custom-error-location").append(e):$(o).parent().append(e)},rules:{phone:{required:!0,phoneUS:!0},phone2:{required:!0,phoneUS:!0},postal_code:{required:!0,cdnPostal:!0},firstname:{required:!0,maxlength:100},lastname:{required:!0,maxlength:100},email:{required:!0,maxlength:100},email2:{required:!0,maxlength:100}}}),r.find("button.cancel").on("click",function(){window.location.replace(i)})}function t(e){var o,t;return r.valid()&&(r.removeClass("server-error"),l.addClass("submitting"),o=r.serializeArray(),t=n(o),s(t)),!1}function n(e){return e}function s(e){$.ajax({method:"POST",url:a,data:e}).success(function(e){l.addClass("success"),l.removeClass("submitting")}).error(function(e){r.addClass("server-error"),l.removeClass("submitting"),ScrollMan.to($("#server-error"))})}var a,i,r,l;return{init:e,validation:o,process:t,parse:n,submit:s}}();!function(){window.location.pathname.indexOf("/fr/")!==-1&&$("body").addClass("fr")}(),$(function(){$(document).foundation(),$("[data-responsive-toggle] button").on("click",function(){$("body").toggleClass("site-header-is-active")}),$(".text-carousel").slick({dots:!0,speed:300,infinite:!0,mobileFirst:!0,slidesToShow:1,slidesToScroll:1,prevArrow:'<button type="button" class="slick-prev"><span class="show-for-sr">Previous</span></button>',nextArrow:'<button type="button" class="slick-next"><span class="show-for-sr">Next</span></button>'}),$(".carousel").slick({dots:!0,infinite:!0,speed:300,mobileFirst:!0,slidesToShow:1,slidesToScroll:1,prevArrow:'<button type="button" class="slick-prev"><span class="show-for-sr">Previous</span></button>',nextArrow:'<button type="button" class="slick-next"><span class="show-for-sr">Next</span></button>',responsive:[{breakpoint:640,settings:{slidesToShow:2,slidesToScroll:2}}]}),$(".homepage-carousel").slick({dots:!0,infinite:!0,speed:500,mobileFirst:!0,slidesToShow:1,slidesToScroll:1,arrows:!1,prevArrow:'<button type="button" class="slick-prev"><span class="show-for-sr">Previous</span></button>',nextArrow:'<button type="button" class="slick-next"><span class="show-for-sr">Next</span></button>',responsive:[{breakpoint:640,settings:{fade:!0}},{breakpoint:1024,settings:{arrows:!0,fade:!0}}]}),$(".js-open-socialdrawer").click(function(){var e=$(this).next();e.hasClass("js-socialdrawer-opened")?e.removeClass("js-socialdrawer-opened"):e.addClass("js-socialdrawer-opened")})}),form.init(),$(function(){$(".more-section-menuitem").on("click",function(e){e.preventDefault();var o=$(this).attr("class").match(/[\w-]*category[\w-]*/g);$(".more-section-menu-dropdown-category-wrapper").fadeIn("slow").focus().filter(":not(."+o+")").hide(),$(".more-section-menu-dropdown").addClass("active");var t=$(this).text();$("p.more-section-tagline-tag").fadeOut(),$("h1.more-section-tagline-tag").removeClass("active"),setTimeout(function(){$("h1.more-section-tagline-tag").addClass("active").text(t)},200);var n=$(this),s=n.offset(),a=n.width(),i=s.left+a/2-50;$(".more-section-menu-dropdown-arrow-up").show().css({left:i}),$(".tertiary-cta-more").removeClass("animate"),setTimeout(function(){$(".tertiary-cta-more").addClass("animate")},100)}),$(".more-section-menu-mobile-title").on("click",function(){$(".more-section-menu").toggleClass("active"),$(this).toggleClass("active")}),$(".close-button").on("click",function(){$(".more-section-menu-dropdown-category-wrapper").hide(),$(".more-section-menu-dropdown-arrow-up").hide(),$(".tertiary-cta-more").removeClass("animate"),$("h1.more-section-tagline-tag").removeClass("active"),$("p.more-section-tagline-tag").fadeIn("slow"),$(".more-section-menu-dropdown").removeClass("active")})}),$(window).resize(function(){var e=$(document).width();e<640&&($(".tertiary-cta-more").removeClass("animate"),"flex"===$(".more-section-menu").css("display")&&$(".more-section-menu").css("display","block")),e>640&&"block"===$(".more-section-menu").css("display")&&$(".more-section-menu").css("display","flex")}),$(".help-topics-accordion").on("up.zf.accordion",function(e){setTimeout(function(){$("html,body").animate({scrollTop:$(".is-active").offset().top},"slow")},10)});var modelUrl="https://search.investorsgroup.com/api/cwpsearch?",$location_field=$("#FindAnAdvisor_location"),$name_field=$("#FindAnAdvisor_name"),allConsultants={},lang="en",is_name_query=!1;window.location.href.indexOf("-fr.")>-1&&(lang="fr"),$(function(){$(".search-select").change(function(){"Location"==$(".search-select").val()?($(".find-an-advisor-search-form-field-location").show(),$location_field.focus(),$(".find-an-advisor-search-form-field-name").hide(),is_name_query=!1):"Name"==$(".search-select").val()&&($(".find-an-advisor-search-form-field-name").show(),$name_field.focus(),$(".find-an-advisor-search-form-field-location").hide(),is_name_query=!0)}).trigger("change")});var suggestions={};suggestions.locations=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.whitespace,queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:"data/cities.json"}),suggestions.consultants=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.whitespace,queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:"data/names.json"}),suggestions.postalCode=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.whitespace,queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:"data/postal-code.json"}),$(function(){getCoordinates(),$(".typeahead.itf_location").typeahead({highlight:!0},{name:"locations",source:suggestions.locations,limit:2},{name:"postalCode",source:suggestions.postalCode,limit:2}),$(".typeahead.itf_name").typeahead({highlight:!0},{name:"consultants",source:suggestions.consultants,limit:3}),$("#find-an-advisor-search").submit(function(e){e.preventDefault(),$("#SearchSubmitButton").attr("disabled","disabled"),$("#results-placeholder").removeClass("hide");var o=parseSearchString();getSearchResults(o),sendGoogleAnalytics(o),setTimeout(function(){$("#SearchSubmitButton").removeAttr("disabled")},1500)}),$location_field.focus()});