"use strict";function getCoordinates(){function e(e){var t={};t.lang=lang,t.searchtype="con",t.geo=e.coords.latitude+","+e.coords.longitude,getSearchResults(t)}function t(){console.log("Error with geolocation")}navigator.geolocation&&navigator.geolocation.getCurrentPosition(e,t)}function getSearchResults(e){$("#results-container, #office-search").addClass("hide").html(""),$.getJSON(modelUrl,e).always().done(function(e){var t=JSON.parse(e);allConsultants=shuffle(t),displaySearchResults("result-amount-template",allConsultants,"results-container"),paginateResults(),$("html, body").animate({scrollTop:$("#office-search").offset().top},750)}).fail(function(e){console.log("Data could not be retrieved, please try again",e.status+" "+e.statusText)}),(e.city||e.Pcode||e.geo)&&(e.searchtype="office",e.name="",$.getJSON(modelUrl,e).always().done(function(e){var t=JSON.parse(e);t.length>0&&displaySearchResults("office-template",t,"office-search")}).fail(function(e){console.log("Data could not be retrieved, please try again",e.status+" "+e.statusText)}))}function shuffle(e){for(var t,o,s=e.length;0!==s;)o=Math.floor(Math.random()*s),s-=1,t=e[s],e[s]=e[o],e[o]=t;return e}function paginateResults(){var e=allConsultants.slice(0,5);allConsultants.splice(0,5),displaySearchResults("consultant-template",e,"results-container"),allConsultants.length>0&&displaySearchResults("view-more-template",[],"results-container")}function parseSearchString(){var e={},t=$location_field.val(),o=$name_field.val(),s=new RegExp(/[A-Za-z][0-9][A-Za-z] ?[0-9][A-Za-z][0-9]/);if(e.city="",e.name="",e.Pcode="",e.geo="",e.lang=lang,e.searchtype="con",s.test(t)){var n=t.match(s)[0];n.indexOf(" ")===-1&&(n=n.match(/.{1,3}/g).join().replace(","," ")),e.Pcode=n,t=t.replace(s," ")}return is_name_query?e.name=o:e.city=t,e}function displaySearchResults(e,t,o){var s=document.getElementById(e).innerHTML;Mustache.parse(s);var n=Mustache.render(s,t);$("#"+o).removeClass("hide").append(n),attachComponents(),$("#results-placeholder").addClass("hide")}function attachComponents(){$(document).foundation(),$("[data-fetch-results]").on("click",function(e){e.preventDefault(),$(this).remove(),paginateResults()})}function sendGoogleAnalytics(e){""!==e.name?ga("send","event","Convert","Search","ConnectToAdvisor_Name?"+e.name,0):""!==e.city?ga("send","event","Convert","Search","ConnectToAdvisor_Location?"+e.city,0):""!==e.Pcode&&ga("send","event","Convert","Search","ConnectToAdvisor_Pcode?"+e.Pcode,0)}var form=function(){function e(){$(".ig-form").length&&(l=$(".ig-form"),r=l.find("form"),a=l.find("form").data("endpoint"),i=l.find("form").data("cancel"),$(".toggler").on("click",function(){$(".toggle-content").hide(),$("."+$(this).data("content")).show()}),t())}function t(){var e=$(":input, textarea");e.change(function(e){$(this).addClass("dirty")}),$.validator.setDefaults({debug:!0,success:"valid"}),$.validator.addMethod("cdnPostal",function(e,t){return this.optional(t)||e.match(/[a-zA-Z][0-9][a-zA-Z](-| |)[0-9][a-zA-Z][0-9]/)},"Please specify a valid postal code."),r.validate({submitHandler:function(){form.process()},errorPlacement:function(e,t){$(t).closest(".row").find(".custom-error-location").length?$(t).closest(".row").find(".custom-error-location").append(e):$(t).parent().append(e)},rules:{phone:{required:!0,phoneUS:!0},phone2:{required:!0,phoneUS:!0},postal_code:{required:!0,cdnPostal:!0},firstname:{required:!0,maxlength:100},lastname:{required:!0,maxlength:100},email:{required:!0,maxlength:100},email2:{required:!0,maxlength:100}}}),r.find("button.cancel").on("click",function(){window.location.replace(i)})}function o(e){var t,o;return r.valid()&&(r.removeClass("server-error"),l.addClass("submitting"),t=r.serializeArray(),o=s(t),n(o)),!1}function s(e){return e}function n(e){$.ajax({method:"POST",url:a,data:e}).success(function(e){l.addClass("success"),l.removeClass("submitting")}).error(function(e){r.addClass("server-error"),l.removeClass("submitting"),ScrollMan.to($("#server-error"))})}var a,i,r,l;return{init:e,validation:t,process:o,parse:s,submit:n}}();form.init(),$(function(){$(document).foundation(),$("[data-responsive-toggle] button").on("click",function(){$("body").toggleClass("site-header-is-active")}),$(".text-carousel").slick({dots:!0,speed:300,infinite:!0,mobileFirst:!0,slidesToShow:1,slidesToScroll:1,prevArrow:'<button type="button" class="slick-prev"><span class="show-for-sr">Previous</span></button>',nextArrow:'<button type="button" class="slick-next"><span class="show-for-sr">Next</span></button>'}),$(".carousel").slick({dots:!0,infinite:!0,speed:300,mobileFirst:!0,slidesToShow:1,slidesToScroll:1,prevArrow:'<button type="button" class="slick-prev"><span class="show-for-sr">Previous</span></button>',nextArrow:'<button type="button" class="slick-next"><span class="show-for-sr">Next</span></button>',responsive:[{breakpoint:640,settings:{slidesToShow:2,slidesToScroll:2}}]}),$(".homepage-carousel").slick({dots:!0,infinite:!0,speed:500,mobileFirst:!0,slidesToShow:1,slidesToScroll:1,arrows:!1,prevArrow:'<button type="button" class="slick-prev"><span class="show-for-sr">Previous</span></button>',nextArrow:'<button type="button" class="slick-next"><span class="show-for-sr">Next</span></button>',responsive:[{breakpoint:640,settings:{fade:!0}},{breakpoint:1024,settings:{arrows:!0,fade:!0}}]}),$(".js-open-socialdrawer").click(function(){var e=$(this).next();e.hasClass("js-socialdrawer-opened")?e.removeClass("js-socialdrawer-opened"):e.addClass("js-socialdrawer-opened")})}),$(function(){$(".more-section-menuitem").on("click",function(e){e.preventDefault();var t=$(this).attr("class").match(/[\w-]*category[\w-]*/g);$(".more-section-menu-dropdown-category-wrapper").fadeIn("slow").focus().filter(":not(."+t+")").hide(),$(".more-section-menu-dropdown").addClass("active");var o=$(this).text();$("p.more-section-tagline-tag").fadeOut(),$("h1.more-section-tagline-tag").removeClass("active"),setTimeout(function(){$("h1.more-section-tagline-tag").addClass("active").text(o)},200);var s=$(this),n=s.offset(),a=s.width(),i=n.left+a/2-50;$(".more-section-menu-dropdown-arrow-up").show().css({left:i}),$(".tertiary-cta-more").removeClass("animate"),setTimeout(function(){$(".tertiary-cta-more").addClass("animate")},100)}),$(".more-section-menu-mobile-title").on("click",function(){$(".more-section-menu").toggleClass("active"),$(this).toggleClass("active")}),$(".close-button").on("click",function(){$(".more-section-menu-dropdown-category-wrapper").hide(),$(".more-section-menu-dropdown-arrow-up").hide(),$(".tertiary-cta-more").removeClass("animate"),$("h1.more-section-tagline-tag").removeClass("active"),$("p.more-section-tagline-tag").fadeIn("slow"),$(".more-section-menu-dropdown").removeClass("active")})}),$(window).resize(function(){var e=$(document).width();e<640&&($(".tertiary-cta-more").removeClass("animate"),"flex"===$(".more-section-menu").css("display")&&$(".more-section-menu").css("display","block")),e>640&&"block"===$(".more-section-menu").css("display")&&$(".more-section-menu").css("display","flex")}),$(".help-topics-accordion").on("up.zf.accordion",function(e){setTimeout(function(){$("html,body").animate({scrollTop:$(".is-active").offset().top},"slow")},10)});var modelUrl="https://search.investorsgroup.com/api/cwpsearch?",$location_field=$("#FindAnAdvisor_location"),$name_field=$("#FindAnAdvisor_name"),allConsultants={},lang="en",is_name_query=!1;window.location.href.indexOf("-fr.")>-1&&(lang="fr"),$(function(){$(".search-select").change(function(){"Location"==$(".search-select").val()?($(".find-an-advisor-search-form-field-location").show(),$location_field.focus(),$(".find-an-advisor-search-form-field-name").hide(),is_name_query=!1):"Name"==$(".search-select").val()&&($(".find-an-advisor-search-form-field-name").show(),$name_field.focus(),$(".find-an-advisor-search-form-field-location").hide(),is_name_query=!0)}).trigger("change")});var suggestions={};suggestions.locations=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.whitespace,queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:"data/cities.json"}),suggestions.consultants=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.whitespace,queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:"data/names.json"}),suggestions.postalCode=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.whitespace,queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:"data/postal-code.json"}),$(function(){getCoordinates(),$(".typeahead.itf_location").typeahead({highlight:!0},{name:"locations",source:suggestions.locations,limit:2},{name:"postalCode",source:suggestions.postalCode,limit:2}),$(".typeahead.itf_name").typeahead({highlight:!0},{name:"consultants",source:suggestions.consultants,limit:3}),$("#find-an-advisor-search").submit(function(e){e.preventDefault(),$("#SearchSubmitButton").attr("disabled","disabled"),$("#results-placeholder").removeClass("hide");var t=parseSearchString();getSearchResults(t),sendGoogleAnalytics(t),setTimeout(function(){$("#SearchSubmitButton").removeAttr("disabled")},1500)}),$location_field.focus()});